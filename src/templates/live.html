<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Live preview | loading‚Ä¶</title>

    <link rel="stylesheet" href="/static/common.css" />
    <link rel="stylesheet" href="/static/course.css" />
    <link rel="stylesheet" href="/static/figure_zoom.css" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
      integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.rawgit.com/dreampulse/computer-modern-web-font/master/fonts.css"
    />
  </head>

  <body>
    <div id="app"></div>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"
      integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6"
      crossorigin="anonymous"
    ></script>
    <script src="/static/math_rendering.js"></script>
    <script>
      const output = document.getElementById("app");

      source = new EventSource(`/sse`);

      source.addEventListener("message", (event) => {
        output.innerHTML = event.data;

        const heading_match = event.data.match(/^# +(.*)$/m);
        if (match) document.title = `Live preview | ${match[1].trim()}`;

        renderMath();
        initFigureZoom();
      });

      source.onopen = () => console.log("üîå SSE connected");
      source.onerror = (err) => {
        console.warn("‚ùå SSE error", err);
        // alert("Sync error");
        // TODO: Sync status
        source.close();
      };
    </script>

    <!-- Open folds before printing -->
    <script>
      window.addEventListener("beforeprint", (event) => {
        for (const detailEl of document.querySelectorAll("details")) {
          if (detailEl.getAttribute("open") == null) {
            detailEl.setAttribute("data-was-closed", "true");
          }
          detailEl.setAttribute("open", "");
        }
      });

      window.addEventListener("afterprint", (event) => {
        for (const detailEl of document.querySelectorAll("details")) {
          if (detailEl.getAttribute("data-was-closed") != null) {
            detailEl.removeAttribute("data-was-closed");
            detailEl.removeAttribute("open");
          }
        }
      });
    </script>
  </body>
</html>
